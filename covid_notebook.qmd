---
title: "Impact de la COVID-19 sur les déplacements de personnes en Wallonie"
author: "Alex Godin, Jeff Loiseau, Valentin Picart, Valentin Vandenbosche"
format:
  html:
    code-fold: true
    code-tools: true
    toc: true
editor: visual
lang: fr
---

<!--# Ceci est un commentaire. -->

<!--% Ceci est une consigne. Ne jamais modifier ni déplacer les consignes dans le document ! -->

<!--% Complétez le titre et le nom des auteurs (auteur1, auteur2, auteur3 et auteur 4) dans l'entête YAML.-->

## Introduction et but

<!--% Rédigez une courte introduction de 3 ou 5 phrases qui présente vos données. Ajoutez une phrase de but. Vous devez citer la bibliographie en utilisant le formatage Markdown ad hoc et en incluant votre référence au format bibtex dans le fichier references.bib. -->

Les données utilisées dans ce travail proviennent des "Rapports sur la mobilité de la communauté" publiés par Google durant la pandémie de Covid-19. Elles décrivent l'évolution des déplacements de population en Belgique, plus précisément en Wallonie, vers différents types de lieux tels que les commerces, les lieux de travail, les parcs ou les transports en commun. Les variations de mobilité sont exprimées en pourcentage par rapport à une période de référence antérieure à la pandémie (janvier-février 2020). Ces données sont anonymisées et issues des utilisateurs ayant activé l'historique des positions sur Google Maps, ce qui permet d'analyser les tendances globales tout en respectant la vie privée.

L'objectif de ce travail est d'analyser l'impact de la pandémie de Covid-19 sur les déplacements de personnes en Wallonie, en mettant en évidence les changements de mobilité selon les types de lieux et les périodes.

## Matériel et méthodes

<!--% Indiquez ici d'où viennent les données et aussi quel logiciel (et version) vous utilisez pour les analyses. Inspirez-vous des projets déjà réalisés. -->

Nous avons utilisé les *Community Mobility Reports* de Google, basés sur des données anonymisées de Google Maps, afin d’analyser les variations de mobilité liées aux mesures COVID-19. Les données mobilisent différentes catégories de lieux (travail, commerces, loisirs, transports en commun, résidentiel).

Les rapports n’étant plus mis à jour depuis octobre 2022, nous avons exploité les données historiques pour la Wallonie sur les années 2020, 2021 et 2022, avec un focus particulier sur 2020 et 2021. Une application intéractive est disponible à l'adresse suivante <https://dimiter.shinyapps.io/covid-19_mobility/> , permet de visualiser de manière dynamique les données.

L'analyse est réalisée avec la SciViews Box 2025 dans Saturn Cloud (Linux Ubuntu 22.04), utilisant le logiciel R (r R.version.string). Le package {pastecs} version r packageVersion("pastecs") est utilisé pour étudier la série temporelle.

## Analyses

<!--% Lisez bien les éléments devant guider votre analyse proposée dans le README.-->

```{r setup, include=FALSE}
# Nécessaire pour les tests SDD, ne pas utiliser dans un "vrai" projet
if (!"tools:tests" %in% search())
  source(here::here("tests/tools_tests.R"), attach(NULL, name = "tools:tests"))
# Configuration de l'environnement
SciViews::R("ts", lang = "fr")
```

<!--% Ajoutez le nombre de chunks que vous souhaitez. Répartissez-vous le travail correctement. Structurez la section en partie avec des titres explicites de niveau trois.-->

# Importation

```{r import}
# Importation
covid <- read("data/mobility_wallonia.rds")
```

# Nettoyage des données

```{r cleaning}
#Nettoyage du tableau
covid <- covid %>%
  rename(com_loi = retail_and_recreation_percent_change_from_baseline,
    alim_pharma = grocery_and_pharmacy_percent_change_from_baseline,
    parcs = parks_percent_change_from_baseline,
    tec = transit_stations_percent_change_from_baseline,
    travail = workplaces_percent_change_from_baseline,
    residence = residential_percent_change_from_baseline)
```

### Manipulation de séries temporelles

```{r week}
# Copie de la série initiale sous une autre nom
covidw <- covid
# Calcul des jours de la semaine
covidw$weekdays <- weekdays(as.POSIXct(covidw$date))
# Les données du week-end sont remplacées par des valeurs manquantes
covidw[covidw$weekdays == "Saturday" | covidw$weekdays == "Sunday" , 2:7] <- NA 
# La série temporelle est créée (début le 15 février 2020 = 46e jour de l'année 2020)
covidw_ts <- ts(covidw$parcs, start = c(2020, 46), frequency = 365)
plot(covidw_ts)
# Aggrégation par moyenne des valeurs par semaine
covidw_ts2 <- aggregate(covidw_ts, 52, FUN = collapse::fmean, ts.eps = 1/52)
plot(covidw_ts2)

# Copie de la série initiale sous un autre nom
covidwe <- covid

# Calcul des jours de la semaine
covidwe$weekdays <- weekdays(as.POSIXct(covidwe$date))

# Les données des jours de semaine sont remplacées par des valeurs manquantes
covidwe[!(covidwe$weekdays %in% c("Saturday", "Sunday")), 2:7] <- NA

# La série temporelle est créée (début le 15 février 2020 = 46e jour de l'année 2020)
covidwe_ts <- ts(covidwe$parcs, start = c(2020, 46), frequency = 365)
plot(covidwe_ts)

# Agrégation par moyenne des valeurs par semaine
covidwe_ts2 <- aggregate(covidwe_ts, 52, FUN = collapse::fmean, ts.eps = 1/52)
plot(covidwe_ts2)
```

**Mobilité dans les TEC de 2020 à 2021** (Alex)

Caractérisation de la mobilité dans les transports en commun durant la pandémie de la COVID :

```{r tstec}
covid_tec_ts <- ts(covid$tec, start = c(2020, 46),  end = c(2021, 365), frequency = 365)
covid_tec <- aggregate(covid_tec_ts, 52, FUN = collapse::fmean, ts.eps = 1/52)
plot(covid_tec) 
```

Une diminution flagrante est observable aux alentours de mi mars 2020, ceci est dû au premier confinement, les transports en commun étaient, presque ou entièrement interrompu. Ensuite, une phase d'augmentation s'en suit et elle durera jusque mai 2020, où une phase de plateau a lieu. Une deuxième diminution progressive jusqu'en 2021 est la cause d'un second confinement (2 novembre 2020). Cela revient à la normale progressivement, et meme un pic plus élevé qu'avant l'arrivée du Covid est observé. Une dernière petite diminution s'établit jusqu'en 2020 suivant ce pic avant de stagner.

La fonction ts() a été utilisée pour obtenir notre jeu de données visualisé correctement dans le temps.

La fonction aggregate() a été utilisée afin de lisser le graphique afin qu'il soit plus facilement interprétable.

**Mobilité au travail en semaine de 2020 à 2021** (Jeff)

L’objectif de cette analyse est d’examiner la mobilité des habitants de Wallonie durant la pandémie de 2020–2021. Les données utilisées couvrent la période allant du 15 février 2020 au 31 décembre 2021. Nous nous intéressons uniquement au jour de semaine.

```{r}
covidwj <- covidw %>% 
  filter(!weekdays %in% c("Saturday", "Sunday"))
covid_j <- ts(covidwj$travail, start = c(2020, 46),  end = c(2021, 365), frequency = 365)
covid_work <- aggregate(covid_j, 52, FUN = collapse::fmean, ts.eps = 1/52)
plot(covid_work,
  xlab = "Temps",
  ylab = "Tendance de mobilité ",
  main = "Evolution des tendances de 
  mobilité pour le travail durant la période Covid (2020-2021)")


```

Le graphique illustre les déplacements pour le travail des Wallons entre le début de l’année 2020 et la fin de 2021, période fortement marquée par la pandémie de Covid-19. L’axe horizontal représente le temps, tandis que l’axe vertical indique la tendance de mobilité, exprimée en pourcentage par rapport à une situation de référence antérieure à la crise sanitaire.

Dès les premiers mois de 2020, on observe une chute spectaculaire de la mobilité professionnelle, atteignant près de -70 %. Cette baisse brutale correspond à l’instauration des premiers confinements et à la généralisation du télétravail, imposés pour freiner la propagation du virus.

Au fil des mois, la courbe montre une alternance de hausses et de baisses. Les périodes de relâchement des mesures sanitaires entraînent une légère reprise des déplacements, traduisant un retour partiel au bureau ou une relance des activités économiques. À l’inverse, chaque nouvelle vague épidémique provoque une rechute de la mobilité, signe du retour aux restrictions et à une intensification du télétravail.

Même à l’approche de 2022, la tendance reste nettement en dessous du niveau normal, oscillant autour de -30 à -40 %. Cela témoigne d’un changement durable dans les habitudes de travail, avec une adoption plus large du télétravail et une réorganisation des modes de déplacement.

```{r}
as.POSIXct((time(covid_j)[covid_j< -70]-1970)*60*60*24*365.25)
```

Nous avons tenté de comprendre les raisons de la baisse de fréquentation des travailleurs durant la pandémie. Notre première intuition était que les pics à –70 % pouvaient être liés à des jours fériés. Malheureusement, cette hypothèse n’a donné aucun résultat significatif.

Une autre piste possible serait que ces chutes abruptes soient liées à certains événements sanitaires majeurs durant la pandémie de COVID-19, comme l’annonce de nouvelles mesures ou des périodes de restrictions renforcées. Il ne s’agit cependant que d’une hypothèse, qui nécessiterait des données supplémentaires pour être confirmée.

**Mobilité dans les commerces et loisirs de 2020 à 2021, comparaison semaine/week-end** (Valentin P)

L’objectif de cette analyse est d’évaluer l’impact de la pandémie de COVID-19 sur la fréquentation des commerces et loisirs. Un objet spatio-temporel a donc été construit de manière à couvrir l’ensemble de la période critique.

```{r tsp}
covidw_com_loi_ts <- ts(covidw$com_loi, start = c(2020, 46), end = c(2021, 365), frequency = 365)
covidw_tsp <- aggregate(covidw_com_loi_ts, 52, FUN = collapse::fmean, ts.eps = 1/52)
plot(covidw_tsp,
  xlab = "Temps",
  ylab = "Tendance de mobilité pour les commerces et loisirs",
  main = "Tendances de mobilité pour les commerces et loisirs durant la période Covid (2020-2021, semaine)")
covidwe_com_loi_ts <- ts(covidwe$com_loi, start = c(2020, 46), end = c(2021, 365), frequency = 365)
covidwe_tsp <- aggregate(covidwe_com_loi_ts, 52, FUN = collapse::fmean, ts.eps = 1/52)
plot(covidwe_tsp,
  xlab = "Temps",
  ylab = "Tendance de mobilité pour les commerces et loisirs",
  main = "Tendances de mobilité pour les commerces et loisirs durant la période Covid (2020-2021, week-end)")
```

Les graphiques montrent une forte baisse de la mobilité dans les commerces et loisirs dès mars 2020, en lien direct avec le premier confinement. Cette diminution est visible aussi bien en semaine que le week-end, mais elle est plus marquée durant les week-ends, périodes habituellement consacrées aux activités de loisirs.

Une reprise progressive s’observe à partir du printemps–été 2020, particulièrement le week-end, sans toutefois atteindre le niveau de référence pré-pandémique. À l’automne 2020, le second confinement entraîne une nouvelle chute de fréquentation, confirmant la forte dépendance de ce type de mobilité aux mesures sanitaires.

**Mobilité dans les parcs entre 2020 et 2021** (Valentin V)

L’objectif de cette analyse est d’évaluer l’impact de la pandémie de COVID-19 sur la fréquentation des parcs. Un objet spatio-temporel a donc été construit de manière à couvrir l’ensemble de la période critique.

Aucune distinction n’est opérée entre les jours de semaine et les week-ends. Cette décision repose sur l’hypothèse que les dynamiques de fréquentation des parcs demeurent relativement homogènes tout au long de la semaine, et que la séparation entre weekend et semaine ne constitue pas ici un facteur déterminant.

On agrège les données par semaine pour ne pas avoir les fluctuations journalières (pouvant être dû aux variations météorologiques qui sont peu intéressantes ici.

```{r}
covid_parcs_ts <- ts(covid$parcs, start = c(2020, 46), end = c(2021, 365), frequency = 365)
covid_parcs_tsp <- aggregate(covid_parcs_ts, 52, FUN = collapse::fmean, ts.eps = 1/52)
plot(covid_parcs_tsp)
```

Ce graphique met en évidence trois grandes phases distinctes :

1\) Une forte chute début de l'année 2020 suivit d'un rebond massif vers la mi-2020.

2\) A partir de l'automne 2020, on voit une chute rapide des fréquentations.

3\) En 2021, on voit une tendance globale à la hausse puis une décroissance progressive en fin d'année.

On peux pousser cette analyse pour essayer d'expliquer ces variation et donc peaufiner cette interprétation.

### Analyse de séries temporelles

**Mobilité dans les TEC de 2020 à 2021** (Alex)

Le test de tendance va permettre de vérifier si la mobilité des transports en commun a connu une reprise progressive et durable entre 2020 et 2021, après le premier confinement. Pour ce faire, la série temporelle est restreinte à la période postérieure au premier confinement (dans la fonction ts), puis soumise à la fonction trend.test(), cela permet de déterminer si l’évolution observée est statistiquement significative ou si elle pourrait être due au hasard.

```{r trend tec}
covid_tec_ts2 <- ts(covid$tec, start = c(2020, 80),  end = c(2021, 365), frequency = 365)

set.seed(2000)
trend_tec2 <- trend.test(covid_tec_ts2, R = 999)
plot(trend_tec2)

```

Le test de tendance, basé sur la série temporelle étudiant l'effet de la Covid sur les transports en commun, montre une tendance positive significative (ligne verticale en dehors de la distribution simulée) après l'événement du premier confinement. Cela indique que la mobilité en transport en commun a effectivement augmenté au cours de la période 2020–2021, confirmant la reprise progressive de la mobilité après le choc initial des confinements.

**Mobilité au travail en semaine de 2020 à 2021** (Jeff)

bla

```{r}
covid_work <- ts(covidwj$travail, start = c(2020, 46),  end = c(2021, 365), frequency = 365)
covid_work <- aggregate(covid_work, 52, FUN = collapse::fmean, ts.eps = 1/52)

set.seed(2000)
trend_work <- trend.test(covid_work, R = 999)
plot(trend_work)

local_work <- local.trend(covid_work)
plot(local_work)

```

Pour mieux comprendre l’évolution des déplacements liés au travail durant la crise sanitaire, deux graphiques statistiques viennent compléter l’analyse précédente. Ils permettent d’approfondir la lecture des données en vérifiant leur distribution et en repérant d’éventuels changements dans les comportements.

Le premier graphique combine un histogramme et un Q-Q plot. L’histogramme montre la répartition de la variable t, qui semble suivre une forme en cloche centrée autour de zéro. Cela suggère que les données sont réparties de manière assez équilibrée, comme dans une distribution normale. Le Q-Q plot vient confirmer cette impression : les points suivent bien la diagonale, ce qui signifie que les quantiles de t sont proches de ceux d’une loi normale. En clair, cela veut dire que les données sont « normales » au sens statistique, ce qui est utile pour appliquer certains tests ou modèles.

Le deuxième graphique est un CUSUM, ou graphique de la somme cumulative. Il permet de visualiser les changements dans les déplacements au fil du temps. On y voit deux courbes : une ligne noire en pointillés qui représente les données brutes cumulées, et une ligne rouge plus lisse qui montre la tendance générale. Ce graphique révèle une forte baisse des déplacements dès le début de 2020, suivie de plusieurs fluctuations. Cela correspond aux différentes vagues de Covid et aux mesures sanitaires qui ont été prises.De plus, aucun phénomène cyclique ou saisonnier ne se dégage clairement. En revanche, on note une remontée progressive de la tendance à la fin de l’année 2021, conséquence du déconfinement et de la reprise des différents secteurs de la société après la crise sanitaire.

En résumé, ces deux graphiques confirment que la pandémie a eu un impact fort et durable sur les déplacements professionnels. Les données sont bien distribuées, ce qui permet une analyse fiable, et le CUSUM montre clairement les effets des confinements et du télétravail sur la mobilité.

**Mobilité dans les commerces et loisirs le weekend de 2020 à 2021** (Valentin P)

bla

```{r}
set.seed(1826)
trendw_com_loi <- trend.test(covidw_tsp, R = 999)
plot(trendw_com_loi)
set.seed(9872)
trendwe_com_loi <- trend.test(covidwe_tsp, R = 999)
plot(trendwe_com_loi)
```

Les tests de tendance appliqués à la mobilité dans les commerces et loisirs en Wallonie entre 2020 et 2021 révèlent une reprise significative. Cette reprise est plus marquée le week-end, traduisant une relance des activités récréatives. En semaine, la tendance est également positive mais plus modérée, en lien avec une reprise économique partielle avec des contraintes persistantes (télétravail...). Ces résultats confirment que les effets de la pandémie sur la mobilité ont été progressivement atténués, avec des dynamiques différentes selon les jours.

```{r acf}
acf(covidw_tsp)
acf(covidwe_tsp)
spectrum(covidw_tsp, spans = c(3, 5))
spectrum(covidwe_tsp, spans = c(3, 5))
```

L’analyse des fonctions d’autocorrélation et des spectres de densité confirme que la mobilité dans les commerces et loisirs en Wallonie entre 2020 et 2021 est dominée par une tendance lente, liée aux mesures sanitaires. Les jours de semaine présentent une structure temporelle plus régulière, tandis que les week-ends sont plus sensibles aux événements ponctuels. Aucune saisonnalité forte n’est détectée, mais une inertie temporelle est bien présente, justifiant l’usage de modèles de séries temporelles pour capturer ces dynamiques.

```{r local cl}
covidw_tsp_local <- local.trend(covidw_tsp)
covidwe_tsp_local <- local.trend(covidwe_tsp)
```

**Mobilité dans les parcs de 2020 à 2021** (Valentin V)

Pour caractériser le graphique vu précédemment, on réalise une analyse de la tendance locale pour essayer de confirmer les interprétations précédentes.

```{r}
covid_parcs_local <- local.trend(covid_parcs_tsp)
```

L’analyse de la tendance locale met en évidence une succession de régimes temporels dans la fréquentation des parcs en Wallonie entre 2020 et 2021. Après une phase initiale de baisse marquée correspondant au premier confinement, un retournement brutal de tendance est observé au printemps 2020, traduisant un recours accru aux espaces verts lors du déconfinement. Cette dynamique est suivie d’une nouvelle phase de repli à l’automne 2020, puis d’une reprise plus progressive et durable en 2021. Ces résultats confirment le caractère non stationnaire de la série et soulignent l’adaptation progressive des comportements de mobilité au contexte sanitaire.

### Décomposition de séries temporelles

**Mobilité dans les TEC de 2020 à 2021** (Alex)

Après avoir mis en évidence une tendance générale de la mobilité dans les transports en commun, il est intéressant d’aller plus loin en séparant les différentes composantes de la série temporelle. La décomposition permet de distinguer la tendance de fond, les variations saisonnières éventuelles et le bruit résiduel.

Pour cela, une décomposition additive de la série est réalisée à l’aide de la fonction tsd(), ce qui facilite l’interprétation des différentes composantes de la mobilité dans les transports en commun.

```{r decomptec}
decomp_tec <- tsd(covid_tec, method = "average", type = "additive", order = 6, times = 3)
plot(decomp_tec, col = 1:3)
```

La première partie correspond à la série observée. On y retrouve une forte chute au début de la période, liée au premier confinement, suivie de fluctuations importantes au cours du temps. Ces variations reflètent les différentes phases de restrictions et d’assouplissements mises en place durant la pandémie.

La composante filtrée (tendance) met en évidence l’évolution générale de la mobilité. Après une baisse marquée en début de période, la tendance augmente progressivement, ce qui confirme une reprise lente mais réelle de l’utilisation des transports en commun après le premier confinement. Cette tendance sera extraite par la suite pour l'analyser plus finement.

Enfin, les résidus représentent les variations de court terme qui ne sont pas expliquées par la tendance. Ils oscillent autour de zéro et traduisent des perturbations temporaires.

Afin de faciliter l’analyse, il est donc pertinent d’extraire la composante lissée de la série. Cette étape permet de se concentrer uniquement sur la dynamique globale des transports en commun, en éliminant les variations ponctuelles et le bruit résiduel.

```{r extracttec}
tec_extract <- extract(decomp_tec, components = "filtered")
plot(tec_extract,
  xlab = "Temps",
  ylab = "Tendance de mobilité dans les tec",
  main = "Evolution des tendances de mobilité pour les tec durant la période Covid")

```

La tendance extraite montre une forte baisse de la mobilité dans les transports en commun au début de la période, en lien avec le premier confinement. Une reprise progressive s’observe ensuite au cours de l’année 2020, avant une nouvelle diminution à la fin de l’année lors du renforcement des restrictions. En 2021, la tendance repart à la hausse, indiquant une reprise plus durable de la mobilité, même si le niveau d’avant la pandémie n’est pas totalement retrouvé.

**Mobilité au travail en semaine de 2020 à 2021** (Jeff)

```{r}
covid_je <- tsd(covid_j, method = "average", type = "additive", order = 10, times = 10)
plot(covid_je, col = 1:3)

```

Le graphique du milieu présente la composante saisonnière : on observe un cycle annuel régulier, indiquant que la mobilité suit un schéma saisonnier identifiable.

Enfin, les résidus montrent les variations restantes une fois la tendance et la saisonnalité retirées. La plupart de ces fluctuations sont aléatoires, mais certains pics extrêmes correspondent clairement aux restrictions liées au COVID-19.

En résumé, la mobilité est influencée par une saisonnalité stable et par des événements exceptionnels, principalement les mesures de la pandémie

```{r}
job_extract <- extract(covid_je, components = "filtered")
plot(job_extract,
  xlab = "Temps",
  ylab = "Tendance de mobilité pour le travail",
  main = "Evolution des tendances de mobilité pour le travail durant la période Covid")
```

**Mobilité dans les commerces et loisirs le weekend de 2020 à 2021** (Valentin P)

bla

```{r decomp_com_loi}
decompw_com_loi <- tsd(covidw_tsp, method = "average", type = "additive", order = 6, times = 10)
plot(decompw_com_loi, col = 1:3)
decompwe_com_loi <- tsd(covidwe_tsp, method = "average", type = "additive", order = 6, times = 10)
plot(decompwe_com_loi, col = 1:3)
```

La décomposition des séries temporelles indique que les variations sont principalement dues aux événements exceptionnels liés à la pandémie plutôt qu’à une saisonnalité régulière. Les légères hausses estivales suggèrent néanmoins un effet saisonnier limité, surtout le week-end.

En conclusion, la mobilité dans les commerces et loisirs a été fortement et durablement affectée par la COVID-19, avec des fluctuations plus importantes durant les week-ends, reflet de la suspension puis de la reprise partielle des activités de loisirs.

```{r extract_com_loi}
extractw_com_loi <- extract(decompw_com_loi, components = "filtered")
plot(extractw_com_loi,
  xlab = "Temps",
  ylab = "Tendance de mobilité pour les commerces et loisirs",
  main = "Tendances de mobilité pour les commerces et loisirs durant la période Covid (2020-2021, semaine)")
extractwe_com_loi <- extract(decompwe_com_loi, components = "filtered")
plot(extractwe_com_loi,
  xlab = "Temps",
  ylab = "Tendance de mobilité pour les commerces et loisirs",
  main = "Tendances de mobilité pour les commerces et loisirs durant la période Covid (2020-2021, week-end)")
```

Les tendances filtrées extraites des séries hebdomadaires montrent que la mobilité dans les commerces et loisirs a été profondément affectée par la pandémie, avec deux phases de chute majeures en 2020. La reprise observée en 2021 est plus marquée le week-end, traduisant une relance des activités récréatives. En semaine, la reprise est plus modérée, en lien avec une reprise économique partielle. Ces tendances confirment que les effets de la pandémie sur la mobilité ont été progressivement atténués, mais avec des dynamiques distinctes selon les jours.

**Mobilité dans les parcs de 2020 à 2021** (Valentin V)

Pour poursuivre cette analyse, une décomposition par LOESS est réalisé.

```{r}
decomp_parcs <- tsd(covid_parcs_tsp, method = "average", type = "additive", order = 6, times = 3)
plot(decomp_parcs, col = 1:3)
```

analyse de cette décomposition

## Conclusion

<!--% Lorsque toutes les analyses sont réalisées, terminez ce bloc-notes avec 3 à 6 phrases de conclusion en rapport avec ce que vous avez observé dans vos analyses. Quels sont les éléments les plus pertinents que vous retenez ? -->

Il a a des tendances à cause de ce virus que tout le monde nomme COVID19
