---
title: "Impact de la COVID-19 sur les déplacements de personnes en Wallonie"
author: "Alex Godin, Jeff Loiseau, Valentin Picart, Valentin Vandenbosche"
format:
  html:
    code-fold: true
    code-tools: true
    toc: true
editor: visual
lang: fr
---

<!--# Ceci est un commentaire. -->

<!--% Ceci est une consigne. Ne jamais modifier ni déplacer les consignes dans le document ! -->

<!--% Complétez le titre et le nom des auteurs (auteur1, auteur2, auteur3 et auteur 4) dans l'entête YAML.-->

## Introduction et but

<!--% Rédigez une courte introduction de 3 ou 5 phrases qui présente vos données. Ajoutez une phrase de but. Vous devez citer la bibliographie en utilisant le formatage Markdown ad hoc et en incluant votre référence au format bibtex dans le fichier references.bib. -->

... Introduction et but...

## Matériel et méthodes

<!--% Indiquez ici d'où viennent les données et aussi quel logiciel (et version) vous utilisez pour les analyses. Inspirez-vous des projets déjà réalisés. -->

Nous avons utilisé les *Community Mobility Reports* de Google, basés sur des données anonymisées de Google Maps, afin d’analyser les variations de mobilité liées aux mesures COVID-19. Les données mobilisent différentes catégories de lieux (travail, commerces, loisirs, transports, résidentiel).

Les rapports n’étant plus mis à jour depuis octobre 2022, nous avons exploité les données historiques pour la Wallonie sur les années 2020, 2021 et 2022, avec un focus particulier sur 2020 et 2021. Une application intéractive est disponible à l'adresse suivante <https://dimiter.shinyapps.io/covid-19_mobility/> , permet de visualiser de manière dynamique les données.

L'analyse est réalisée avec la SciViews Box 2025 dans Saturn Cloud (Linux Ubuntu 22.04), utilisant le logiciel R (r R.version.string). Le package {pastecs} version r packageVersion("pastecs") est utilisé pour étudier la série temporelle.

## Analyses

<!--% Lisez bien les éléments devant guider votre analyse proposée dans le README.-->

```{r setup, include=FALSE}
# Nécessaire pour les tests SDD, ne pas utiliser dans un "vrai" projet
if (!"tools:tests" %in% search())
  source(here::here("tests/tools_tests.R"), attach(NULL, name = "tools:tests"))
# Configuration de l'environnement
SciViews::R("ts", lang = "fr")
```

<!--% Ajoutez le nombre de chunks que vous souhaitez. Répartissez-vous le travail correctement. Structurez la section en partie avec des titres explicites de niveau trois.-->

# Importation

```{r import}
# Importation
covid <- read("data/mobility_wallonia.rds")
```

# Nettoyage des données

```{r cleaning}
#Nettoyage du tableau
covid <- covid %>%
  rename(com_loi = retail_and_recreation_percent_change_from_baseline,
    alim_pharma = grocery_and_pharmacy_percent_change_from_baseline,
    parcs = parks_percent_change_from_baseline,
    tec = transit_stations_percent_change_from_baseline,
    travail = workplaces_percent_change_from_baseline,
    residence = residential_percent_change_from_baseline)
```

### Manipulation de séries temporelles

```{r week}
# Copie de la série initiale sous une autre nom
covidw <- covid
# Calcul des jours de la semaine
covidw$weekdays <- weekdays(as.POSIXct(covidw$date))
# Les données du week-end sont remplacées par des valeurs manquantes
covidw[covidw$weekdays == "Saturday" | covidw$weekdays == "Sunday" , 2:7] <- NA 
# La série temporelle est créée (début le 15 février 2020 = 46e jour de l'année 2020)
covidw_ts <- ts(covidw$parcs, start = c(2020, 46), frequency = 365)
plot(covidw_ts)
# Aggrégation par moyenne des valeurs par semaine
covidw_ts2 <- aggregate(covidw_ts, 52, FUN = collapse::fmean, ts.eps = 1/52)
plot(covidw_ts2)

# Copie de la série initiale sous un autre nom
covidwe <- covid

# Calcul des jours de la semaine
covidwe$weekdays <- weekdays(as.POSIXct(covidwe$date))

# Les données des jours de semaine sont remplacées par des valeurs manquantes
covidwe[!(covidwe$weekdays %in% c("Saturday", "Sunday")), 2:7] <- NA

# La série temporelle est créée (début le 15 février 2020 = 46e jour de l'année 2020)
covidwe_ts <- ts(covidwe$parcs, start = c(2020, 46), frequency = 365)
plot(covidwe_ts)

# Agrégation par moyenne des valeurs par semaine
covidwe_ts2 <- aggregate(covidwe_ts, 52, FUN = collapse::fmean, ts.eps = 1/52)
plot(covidwe_ts2)

```

**Mobilité dans les TEC de 2020 à 2021** (Alex)

Caractérisation de la mobilité dans les transports en commun durant la pandémie de la COVID :

```{r covidtec}
covid_tec_ts <- ts(covid$tec, start = c(2020, 46),  end = c(2021, 365), frequency = 365)
covid_tec <- aggregate(covid_tec_ts, 52, FUN = collapse::fmean, ts.eps = 1/52)
plot(covid_tec) 
```

Une diminution flagrante est observable aux alentours de mi mars 2020, ceci est dû au premier confinement, les transports étaient, presque ou entièrement interrompu. Ensuite, une phase d'augmentation s'en suit et elle durera jusque mai 2020, où une phase de plateau a lieu. Une deuxième diminution progressive jusqu'en 2021 est la cause d'un second confinement (2 novembre 2020). Cela revient à la normale progressivement, et meme un pic plus élevé qu'avant l'arrivée du Covid est observé. Une dernière petite diminution s'établit jusqu'en 2020 suivant ce pic avant de stagner.

La fonction ts() a été utilisée pour obtenir notre jeu de données visualisé correctement dans le temps.

La fonction aggregate() a été utilisée afin de lisser le graphique afin qu'il soit plus facilement interprétable.

**Mobilité au travail en semaine de 2020 à 2021** (Jeff)

L’objectif de cette analyse est d’examiner la mobilité des habitants de Wallonie durant la pandémie de 2020–2021. Les données utilisées couvrent la période allant du 15 février 2020 au 31 décembre 2021.Nous nous interessons uniquement au jour de semaine.

```{r}
covidwj <- covidw %>% 
  filter(!weekdays %in% c("Saturday", "Sunday"))
covid_j <- ts(covidwj$travail, start = c(2020, 46),  end = c(2021, 365), frequency = 365)
plot(covid_j,
  xlab = "Temps",
  ylab = "Tendance de mobilité ",
  main = "Evolution des tendances de 
  mobilité pour le travail durant la période Covid (2020-2021)")
covid_je <- tsd(covid_j, method = "average", type = "additive", order = 6, times = 10)
plot(covid_je, col = 1:3)

```

L’analyse de la série temporelle permet de mieux comprendre l’évolution de la mobilité en Wallonie durant la pandémie. Le premier graphique montre la série brute, avec de fortes variations quotidiennes et plusieurs chutes marquées, probablement liées aux mesures sanitaires.

Le graphique du milieu présente la composante saisonnière : on observe un cycle annuel régulier, indiquant que la mobilité suit un schéma saisonnier identifiable.

Enfin, les résidus montrent les variations restantes une fois la tendance et la saisonnalité retirées. La plupart de ces fluctuations sont aléatoires, mais certains pics extrêmes correspondent clairement aux restrictions liées au COVID-19.

En résumé, la mobilité est influencée par une saisonnalité stable et par des événements exceptionnels, principalement les mesures de la pandémie.

De plus la série brute est bruitée et difficile à lire directement.

```{r}
as.POSIXct((time(covid_j)[covid_j< -70]-1970)*60*60*24*365.25)
```

Nous avons tenté de comprendre les raisons de la baisse de fréquentation des travailleurs durant la pandémie. Notre première intuition était que les pics à –70 % pouvaient être liés à des jours fériés. Malheureusement, cette hypothèse n’a donné aucun résultat significatif.

Une autre piste possible serait que ces chutes abruptes soient liées à certains événements sanitaires majeurs durant la pandémie de COVID-19, comme l’annonce de nouvelles mesures ou des périodes de restrictions renforcées. Il ne s’agit cependant que d’une hypothèse, qui nécessiterait des données supplémentaires pour être confirmée.

**Mobilité dans les commerces et loisirs le weekend de 2020 à 2021** (Valentin P)

L’objectif de cette analyse est d’évaluer l’impact de la pandémie de COVID-19 sur la fréquentation des commerces et loisirs d. Un objet spatio-temporel a donc été construit de manière à couvrir l’ensemble de la période critique.

```{r tsp}
covid_com_loi_ts <- ts(covid$com_loi, start = c(2020, 46), end = c(2021, 365), frequency = 365)
covid_tsp <- aggregate(covid_com_loi_ts, 52, FUN = collapse::fmean, ts.eps = 1/52)
plot(covid_tsp,
  xlab = "Temps",
  ylab = "Tendance de mobilité pour les commerces et loisirs",
  main = "Evolution des tendances de mobilité pour les commerces et loisirs durant la période Covid (2020-2021)")
```

bla

**Mobilité dans les parcs entre 2020 et 2021** (Valentin V)

L’objectif de cette analyse est d’évaluer l’impact de la pandémie de COVID-19 sur la fréquentation des parcs. Un objet spatio-temporel a donc été construit de manière à couvrir l’ensemble de la période critique.

Aucune distinction n’est opérée entre les jours de semaine et les week-ends. Cette décision repose sur l’hypothèse que les dynamiques de fréquentation des parcs demeurent relativement homogènes tout au long de la semaine, et que la séparation entre weekend et semaine ne constitue pas ici un facteur déterminant.

Avant cela on doit faire une petite manipulation de nettoyage des données de la série spatio temporelle car cette dernière comporte des valeurs manquantes.

```{r}
covid_parcs_ts <- ts(covid$parcs, start = c(2020, 46), end = c(2021, 365), frequency = 365)
plot(covid_parcs_ts)
```

Ce graphique fait sur base de la série-temporelle sans modification particulière nous donne déjà beaucoup d'information. En effet, on remarque bien deux pics et donc deux chutes des fréquences dans les parcs.

On peut déjà imaginer que cela est dû aux différents confinements que les Wallons ont connus. On peux pousser cette analyse plus loin pour essayer de confirmer cette hypothèse.

### Analyse de séries temporelles

**Mobilité dans les TEC de 2020 à 2021** (Alex)

bla

```{r trend tec}
covid_tec_ts2 <- ts(covid$tec, start = c(2020, 80),  end = c(2021, 365), frequency = 365)

set.seed(2000)
trend_tec2 <- trend.test(covid_tec_ts2, R = 999)
plot(trend_tec2)

```

Le test de tendance, basé sur la série temporelle étudiant l'effet de la Covid sur les transports, montre une tendance positive significative (ligne verticale en dehors de la distribution simulée) après l'événement du premier confinement. Cela indique que la mobilité en transport a effectivement augmenté au cours de la période 2020–2021, confirmant la reprise progressive de la mobilité après le choc initial des confinements.

La séparation des données après le confinement a été faite dans un objet ts et ensuite un trend.test() a été utilisé pour établir la tendance.

**Mobilité au travail en semaine de 2020 à 2021** (Jeff)

bla

```{r}
acf(covid_j)
spectrum(covid_j, spans = c(3, 5))

```

spectrum –\> Le périodogramme montre une forte composante de tendance à long terme, mais aucun cycle dominant régulier, ce qui suggère que la mobilité durant la pandémie n’a pas suivi une périodicité stable. Les variations observées semblent plutôt liées à des évènements exceptionnels et irréguliers, comme les différentes mesures COVID-19, plutôt qu’à un schéma cyclique naturel.

**Mobilité dans les commerces et loisirs le weekend de 2020 à 2021** (Valentin P)

bla

```{r}

```

bla

**Mobilité dans les parcs de 2020 à 2021** (Valentin V)

Pour caractériser le graphique vu précédemment, on fait un graphique d'autocorrélation pour voir s'il y a la présence de cycel ou une tendance générale.

```{r}
acf(covid_parcs_ts_clean)
```

On voit à ce graphique que toutes les barres sont au dessus du seuil de 95% et positives, ont un donc un graphique typique montrant une tendance générale à la hausse.

### Décomposition de séries temporelles

**Mobilité dans les TEC de 2020 à 2021** (Alex)

bla

```{r}
decomp_tec <- tsd(covid_tec, method = "average", type = "additive", order = 6, times = 3)
plot(decomp_tec, col = 1:3)
```

bla

bla

```{r}
tec_extract <- extract(decomp_tec, components = "filtered")
plot(tec_extract,
  xlab = "Temps",
  ylab = "Tendance de mobilité dans les tec",
  main = "Evolution des tendances de mobilité pour les tec durant la période Covid")

```

bla

**Mobilité au travail en semaine de 2020 à 2021** (Jeff)

```{r}
job_extract <- extract(covid_je, components = "filtered")
plot(job_extract,
  xlab = "Temps",
  ylab = "Tendance de mobilité pour le travail",
  main = "Evolution des tendances de mobilité pour le travail durant la période Covid")
```

tendance générale très basse au début, à la hausse par la suite ( aucun sens déjà dit plus faut trouver une autre méthode )

**Mobilité dans les commerces et loisirs le weekend de 2020 à 2021** (Valentin P)

bla

```{r}

```

bla

**Mobilité dans les parcs de 2020 à 2021** (Valentin V)

Autocorrélation

```{r}

```

bla

## Conclusion

<!--% Lorsque toutes les analyses sont réalisées, terminez ce bloc-notes avec 3 à 6 phrases de conclusion en rapport avec ce que vous avez observé dans vos analyses. Quels sont les éléments les plus pertinents que vous retenez ? -->

faites de belle histoire pour mon cheval
